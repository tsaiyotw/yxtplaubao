<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‹å‹™å ±é…¬æ˜ç´°ç¢ºèªèˆ‡è£œä»¶</title>
    <style>
        :root { --primary: #2c3e50; --accent: #0984e3; --danger: #e74c3c; }
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: #f5f6fa; margin: 0; padding: 20px; color: #2f3640; }
        .container { max-width: 500px; margin: 0 auto; background: white; padding: 25px; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: var(--primary); margin-bottom: 25px; border-bottom: 2px solid #f1f2f6; padding-bottom: 10px; }
        
        /* æ˜ç´°å¡ç‰‡ */
        .detail-card { background: #f8f9fa; border-radius: 12px; padding: 20px; margin-bottom: 25px; border: 1px solid #dcdde1; }
        .row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px dashed #dcdde1; }
        .row:last-child { border-bottom: none; }
        .label { font-weight: bold; color: #7f8c8d; }
        .value { font-family: 'Consolas', monospace; font-weight: bold; font-size: 1.1em; color: #2d3436; }
        
        .net-row { margin-top: 10px; padding: 15px; background: #fff; border-radius: 8px; border: 2px solid var(--accent); }
        .net-label { color: var(--accent); font-size: 1.2em; font-weight: bold; }
        .net-value { color: var(--danger); font-size: 1.5em; font-weight: bold; }

        .upload-group { margin-bottom: 20px; }
        .upload-group label { display: block; margin-bottom: 10px; font-weight: bold; color: #2f3640; }
        input[type="file"] { width: 100%; padding: 10px; border: 1px solid #dcdde1; border-radius: 8px; box-sizing: border-box; background: #fff; }
        
        .btn-submit { width: 100%; padding: 18px; background: var(--accent); color: white; border: none; border-radius: 10px; font-size: 1.2em; font-weight: bold; cursor: pointer; transition: 0.3s; margin-top: 10px; }
        .btn-submit:hover { background: #074b83; transform: translateY(-2px); }
        .footer-note { font-size: 0.85em; color: #95a5a6; margin-top: 20px; line-height: 1.6; }
    </style>
</head>
<body>

<div class="container">
    <h2 id="header_company">å‹å‹™å ±é…¬æ˜ç´°ç¢ºèª</h2>
    
    <div class="detail-card">
        <div class="row"><span class="label">æ‰€å¾—äººå§“å</span><span class="value" id="v_name">-</span></div>
        <div class="row"><span class="label">æ‰€å¾—é¡åˆ¥</span><span class="value" id="v_type">-</span></div>
        <div class="row"><span class="label">çµ¦ä»˜ç¸½é¡</span><span class="value" id="v_total">$ 0</span></div>
        <div class="row"><span class="label">ä»£æ‰£æ‰€å¾—ç¨…</span><span class="value" id="v_tax" style="color:var(--accent);">- $ 0</span></div>
        <div class="row"><span class="label">ä»£æ‰£è£œå……ä¿è²»</span><span class="value" id="v_nhi" style="color:var(--accent);">- $ 0</span></div>
        <div class="row net-row">
            <span class="net-label">å¯¦é ˜æ·¨é¡</span>
            <span class="net-value" id="v_net">$ 0</span>
        </div>
    </div>

    <form id="clientForm">
        <div class="upload-group">
            <label>ğŸ“· ä¸Šå‚³èº«åˆ†è­‰æ­£é¢ç…§ç‰‡</label>
            <input type="file" required>
        </div>
        <div class="upload-group">
            <label>ğŸ“· ä¸Šå‚³èº«åˆ†è­‰åé¢ç…§ç‰‡</label>
            <input type="file" required>
        </div>
        <div class="upload-group">
            <label>âœï¸ ä¸Šå‚³æ‰‹å¯«ç°½åç…§ç‰‡ (ç™½ç´™ç°½åæ‹ç…§)</label>
            <input type="file" required>
        </div>
        <button type="submit" class="btn-submit">ç¢ºèªæ˜ç´°ä¸¦æäº¤è³‡æ–™</button>
    </form>

    <div class="footer-note">
        â€» ä»¥ä¸Šé‡‘é¡ç”±æœ¬äº‹å‹™æ‰€é å¡«ï¼Œåƒ…ä¾›æ ¸å°ï¼Œæ‰€å¾—äººç„¡æ³•ä¿®æ”¹ã€‚<br>
        â€» è‹¥é‡‘é¡æœ‰èª¤ï¼Œè«‹è¯ç¹«æœ¬å…¬å¸è²¡å‹™ç¶“è¾¦äººã€‚<br>
        â€» æ‚¨çš„è³‡æ–™å°‡å—æ³•å¾‹ä¿è­·ä¸¦åƒ…ç”¨æ–¼æœ¬æ¬¡ç¨…å‹™ç”³å ±ã€‚
    </div>
</div>

<script>
    // 1. å¾ç¶²å€è®€å–åƒæ•¸
    const p = new URLSearchParams(window.location.search);
    const name = p.get('name') || "æœªæä¾›";
    const total = parseInt(p.get('total')) || 0;
    const type = p.get('type') || "50";
    const isRes = p.get('res') !== 'false';
    const company = p.get('company') || "æœ¬äº‹å‹™æ‰€";

    // 2. å°ˆæ¥­ç¨…å‹™è¨ˆç®—é‚è¼¯ (åŒæ­¥å…¬å¸ç«¯é‚è¼¯)
    let tax = 0, nhi = 0;
    const nhiRate = 0.0211;

    if (isRes) {
        // å¥ä¿è£œå……ä¿è²» (115å¹´åº¦æ¨™æº–)
        if ((type === '50' && total >= 29500) || (type !== '50' && total >= 20000)) {
            nhi = Math.round(total * nhiRate);
        }
        // æ‰€å¾—ç¨… (115å¹´åº¦æ¨™æº–)
        if (type === '50' && total >= 90501) {
            tax = Math.floor(total * 0.05); // è–ªè³‡ 5%
        } else if (type !== '50' && total >= 20000) {
            tax = Math.floor(total * 0.1); // 9A/9B 10%
        }
    } else {
        // éå±…ä½è€… (è–ªè³‡ 18%, åŸ·è¡Œæ¥­å‹™ 20%)
        tax = (type === '50') ? Math.floor(total * 0.18) : Math.floor(total * 0.20);
    }

    const net = total - tax - nhi;

    // 3. æ¸²æŸ“åˆ°ç•«é¢ä¸Š
    document.getElementById('header_company').innerText = company + " å‹å‹™å ±é…¬ç¢ºèª";
    document.getElementById('v_name').innerText = name;
    document.getElementById('v_type').innerText = type + (type==='50'?' è–ªè³‡æ‰€å¾—':' åŸ·è¡Œæ¥­å‹™');
    document.getElementById('v_total').innerText = '$ ' + total.toLocaleString();
    document.getElementById('v_tax').innerText = '- $ ' + tax.toLocaleString();
    document.getElementById('v_nhi').innerText = '- $ ' + nhi.toLocaleString();
    document.getElementById('v_net').innerText = '$ ' + net.toLocaleString();

    // 4. æäº¤å‹•ä½œ
    document.getElementById('clientForm').onsubmit = function(e) {
        e.preventDefault();
        alert("è³‡æ–™ä¸Šå‚³ä¸­...\n(æé†’ï¼šæ­¤è™•æœªä¾†å¯ä¸²æ¥ Power Automate æˆ– Google Sheets)");
    };
</script>
</body>
</html>
